<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=EB Garamond:300,300italic,400,400italic,700,700italic|Cinzel Decorative:300,300italic,400,400italic,700,700italic|Noto Serif TC:300,300italic,400,400italic,700,700italic|Source Code Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"1184yang.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="身份驗證和身份辨識 (Authentication and identity) 幾乎是所有應用程序不可或缺的部分。知道用戶是誰，他們擁有什麼權限，是否登錄以及該用戶的唯一標識符，你的應用程序就可以正確的呈現畫面並為當前登錄的用戶返回正確的數據。 大多數應用程序都需要機制來處理用戶註冊、用戶登錄、密碼加密、和更新，以及圍繞身份管理的其他無數任務。 現代應用程序經常需要諸如，開放式身份驗證 (OAUT">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS Serverless Authentication">
<meta property="og:url" content="https://1184yang.github.io/2020/11/05/AWS-Authentication/index.html">
<meta property="og:site_name">
<meta property="og:description" content="身份驗證和身份辨識 (Authentication and identity) 幾乎是所有應用程序不可或缺的部分。知道用戶是誰，他們擁有什麼權限，是否登錄以及該用戶的唯一標識符，你的應用程序就可以正確的呈現畫面並為當前登錄的用戶返回正確的數據。 大多數應用程序都需要機制來處理用戶註冊、用戶登錄、密碼加密、和更新，以及圍繞身份管理的其他無數任務。 現代應用程序經常需要諸如，開放式身份驗證 (OAUT">
<meta property="og:locale" content="zh-TW">
<meta property="og:image" content="https://1184yang.github.io/2020/11/05/AWS-Authentication/20201106-01.png">
<meta property="og:updated_time" content="2020-12-24T10:13:30.656Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AWS Serverless Authentication">
<meta name="twitter:description" content="身份驗證和身份辨識 (Authentication and identity) 幾乎是所有應用程序不可或缺的部分。知道用戶是誰，他們擁有什麼權限，是否登錄以及該用戶的唯一標識符，你的應用程序就可以正確的呈現畫面並為當前登錄的用戶返回正確的數據。 大多數應用程序都需要機制來處理用戶註冊、用戶登錄、密碼加密、和更新，以及圍繞身份管理的其他無數任務。 現代應用程序經常需要諸如，開放式身份驗證 (OAUT">
<meta name="twitter:image" content="https://1184yang.github.io/2020/11/05/AWS-Authentication/20201106-01.png">

<link rel="canonical" href="https://1184yang.github.io/2020/11/05/AWS-Authentication/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>

  <title>AWS Serverless Authentication | </title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title"></h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首頁</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>歸檔</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分類</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜尋..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/1184yang?tab=repositories" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://1184yang.github.io/2020/11/05/AWS-Authentication/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/1184yang.jpg">
      <meta itemprop="name" content="J.Y. Yang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AWS Serverless Authentication
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2020-11-05 09:42:38" itemprop="dateCreated datePublished" datetime="2020-11-05T09:42:38+08:00">2020-11-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-12-24 18:13:30" itemprop="dateModified" datetime="2020-12-24T18:13:30+08:00">2020-12-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AWS/" itemprop="url" rel="index"><span itemprop="name">AWS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>身份驗證和身份辨識 (Authentication and identity) 幾乎是所有應用程序不可或缺的部分。知道用戶是誰，他們擁有什麼權限，是否登錄以及該用戶的唯一標識符，你的應用程序就可以正確的呈現畫面並為當前登錄的用戶返回正確的數據。</p>
<p>大多數應用程序都需要機制來處理用戶註冊、用戶登錄、密碼加密、和更新，以及圍繞身份管理的其他無數任務。 現代應用程序經常需要諸如，開放式身份驗證 (OAUTH)、多因素身份驗證 (MFA)、和基於時間的一次性密碼 (TOTP) 之類的東西。</p>
<p>過去，開發人員必須從頭開始開發所有身份驗證功能。 僅此一項任務就可能需要一組開發人員花費數週甚至數月的時間才能正確並安全地完成任務。 如今，有諸如 Auth0、Okta、和 Amazon Cognito 之類的完全託管的身份驗證服務可以為我們處理所有這一切。</p>
<p>在此示例中，你將學習如何透過 AWS Amplify 使用 Amazon Cognito 在 React 應用程序中正確安全地實現身份驗證。</p>
<p>這裡要構建一個基本的應用程序，需要進行身份驗證才能查看一個具有有關已登錄用戶的 profile 文件信息頁面。 如果用戶已登錄，則他們可以在 public 公共路由、帶有身份驗證表單的 profile 文件路由和僅對已登錄用戶開放的 protected 受保護路由之間導航。</p>
<p>如果他們尚未登錄，則只能查看公共路由和 profile 文件路由上的身份驗證表單。 如果用戶在未登錄時嘗試訪問受保護的路由，我們會將其重導向到身份驗證表單，以便他們可以登錄，然後在身份驗證後訪問該受保護的路由。</p>
<p>此應用程序還將保持用戶狀態，因此，如果他們刷新該應用程序、或離開該應用程序導航並在稍後返回，他們將會保持在登錄狀態。</p>
<h3 id="Amazon-Cognito"><a href="#Amazon-Cognito" class="headerlink" title="Amazon Cognito"></a>Amazon Cognito</h3><p>Amazon Cognito 是 AWS 完整的身份託管服務。Cognito 允許簡單安全的用戶註冊、登錄、訪問控制 (access control)、和用戶身份管理。Cognito 可以擴展到數百萬用戶，並且還支持使用社交身份提供商 (例如 Facebook、Google 和 Amazon）登錄。 對於任何應用程序的前 50,000 個用戶，它也是免費的。</p>
<h4 id="Amazon-Cognito-的運作方式"><a href="#Amazon-Cognito-的運作方式" class="headerlink" title="Amazon Cognito 的運作方式"></a>Amazon Cognito 的運作方式</h4><p>Cognito 有兩部分： <strong>user pools</strong> 和 <strong>identity pools</strong></p>
<ul>
<li><p>User pools<br>這提供了一個安全的用戶目錄，該目錄存儲了你的所有用戶，並可以擴展到數億用戶。 這是一項完全託管的服務。 作為無伺服器技術，很簡單的就可以設置 <strong>user pools</strong>，而不必擔心任何基礎設施。 User pools 管理所有註冊和登錄帳戶的用戶的資源。</p>
</li>
<li><p>Identity pools<br>這允許您授權登錄到你的應用程序的用戶訪問各種其他 AWS 服務。 假設您想允許用戶訪問 Lambda 函式，以便他們可以從另一個 API 取得數據，您可以在創建 <strong>identity pools</strong> 時指定。 這些 identities 的資源可以是來自 Cognito user pools，甚至是 Facebook 或 Google。</p>
</li>
</ul>
<p>Cognito user pools 允許你的應用程序針對服務調用各種方法來管理用戶身份，包括以下各項：</p>
<ul>
<li>註冊用戶</li>
<li>登錄用戶</li>
<li>登出用戶</li>
<li>修改用戶密碼</li>
<li>重置用戶密碼</li>
<li>確認 MFA 代碼</li>
</ul>
<h4 id="Amazon-Cognito-與-AWS-Amplify"><a href="#Amazon-Cognito-與-AWS-Amplify" class="headerlink" title="Amazon Cognito 與 AWS Amplify"></a>Amazon Cognito 與 AWS Amplify</h4><p>AWS Amplify 以各種方式支援 Amazon Cognito。 首先，你可以直接從 Amplify CLI 創建和配置 Amazon Cognito 服務。 透過 CLI 創建身份驗證服務後，你就可以使用 Amplify JavaScript client 客戶端程式庫從 JavaScript 應用程序調用各種方法。例如 signUp、signIn、和 signOut。</p>
<p>Amplify 還具有預配置的 UI 組件，使你可以僅使用幾行代碼來構建整個身份驗證流程，同時支援 React、React Native、Vue、和 Angular 等前端框架。</p>
<p>在此示例中，你將結合使用 Amplify CLI、Amplify JavaScript client 和 Amplify React UI 組件來構建一個示範路由，身份驗證和受保護路由(<em>routing, authentication, and protected routes</em>)的應用程序。 還將使用 React Router 路由器建立路由和 Ant Design 來為應用程序提供一些基本樣式。</p>
<img src="/2020/11/05/AWS-Authentication/20201106-01.png" title="AWS Authentication">

<h3 id="創建-React-應用程序與-Amplify-專案"><a href="#創建-React-應用程序與-Amplify-專案" class="headerlink" title="創建 React 應用程序與 Amplify 專案"></a>創建 React 應用程序與 Amplify 專案</h3><p>創建一個新的 React 應用程序：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yarn create react-app basic-authentication</span><br><span class="line"></span><br><span class="line">cd basic-authentication</span><br><span class="line"></span><br><span class="line">yarn add aws-amplify @aws-amplify/ui-react antd react-router-dom</span><br></pre></td></tr></table></figure>

<p>現在，在新應用程序的根目錄下，創建 Amplify 專案：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">amplify init</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 請按照步驟為專案命名，環境名稱並設置預設的文本編輯器。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 接受其他所有設置的預設值，然後選擇你的 AWS Profile。</span></span><br></pre></td></tr></table></figure>

<p>現在，Amplify 專案已初始化，我們可以創建身份驗證服務。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">amplify add auth</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Do you want to use the default authentication and security configuration? Default configuration</span><br><span class="line">How do you want users to be able to sign in? Username   </span><br><span class="line">Do you want to configure advanced settings? No, I am done.</span><br></pre></td></tr></table></figure>

<p>現在，身份驗證服務已配置完畢，你可以使用 amplify push 命令部署它：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">amplify push</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">? Are you sure you want to continue? Yes</span><br></pre></td></tr></table></figure>

<p>現在已經部署了身份驗證服務，我們可以開始對其進行應用。</p>
<h4 id="客戶端身份驗證概述"><a href="#客戶端身份驗證概述" class="headerlink" title="客戶端身份驗證概述"></a>客戶端身份驗證概述</h4><p>使用 Amplify，有兩種主要方法可以在客戶端上實現身份驗證：</p>
<ul>
<li><p>Auth class<br>Amplify client 客戶端程式庫 Auth 類提供 30 多種不同的方法，使你可以處理與用戶管理相關的所有事情。 例如  Auth.signUp、Auth.signIn、和 Auth.signOut。</p>
<p>你也可以使用此 Auth 類根據你的應用程序需求，創建完全自定義的身份驗證流程(custom authentication flow)。為此，你則必須自己管理所有的樣式和應用程序狀態。</p>
</li>
<li><p>特定於框架的身份驗證 UI 組件<br>Amplify 針對 React、React Native、Vue、和 Angular 等框架提供特定於框架更高層次的身份驗證技術。 使用這些組件，你僅需用幾行代碼，即可呈現完整的(可自定義的)身份驗證流程。</p>
</li>
</ul>
<p>在此示例中，將使用 AWS Amplify React 程式庫中名為 withAuthenticator 的高階組件 (higher-order component HOC)以及路由，來創建受保護的路由和僅在用戶登錄後才能查看的 profile 配置文件。</p>
<h4 id="構建前端應用程序"><a href="#構建前端應用程序" class="headerlink" title="構建前端應用程序"></a>構建前端應用程序</h4><p>在你的應用程序專案根目錄的 src 目錄中創建以下文件：</p>
<pre><code>Container.js
Nav.js
Profile.js
Protected.js
Public.js
Router.js</code></pre><p>這些文件將執行以下的操作：</p>
<ul>
<li>Container.js<br>該文件包含一個組件，使用該組件可將可重複使用的樣式應用於其他組件。</li>
<li>Nav.js<br>在此組件中，你將創建一個導航 UI。</li>
<li>Profile.js<br>該組件將提供有關已登錄用戶的 profile 配置文件信息。 這也是我們添加身份驗證組件以進行註冊和登錄的組件。</li>
<li>Protected.js<br>這是我們用來示範受保護路由的組件。 如果用戶已登錄，他們將能夠查看此路由。 如果未登錄，他們將重新導向到登錄表單。</li>
<li>Public.js<br>這是一個基本路由，無論用戶是否登錄都可以查看。</li>
<li>Router.js<br>該文件將保存路由器狀態和確定當前路由名稱。</li>
</ul>
<h5 id="Container-組件"><a href="#Container-組件" class="headerlink" title="Container 組件"></a>Container 組件</h5><p>首先，讓我們創建將用於此應用程序的最簡單的組件，即 Container 組件。 我們將使用此組件來包裝所有其他組件，以便在組件之間應用一些可重用的樣式：</p>
<figure class="highlight jsx"><figcaption><span>src/Container.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Container = <span class="function">(<span class="params">&#123; children &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;div style=&#123;styles.container&#125;&gt;</span><br><span class="line">    &#123; children &#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const styles = &#123;</span></span><br><span class="line"><span class="regexp">  container: &#123;</span></span><br><span class="line"><span class="regexp">    margin: '0 auto',</span></span><br><span class="line"><span class="regexp">    padding: '50px 100px'</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Container</span></span><br></pre></td></tr></table></figure>

<p>你現在可以在整個應用程序中使用此組件以應用一致的樣式，而不必在每個組件中重寫樣式。 你可以像這樣使用它：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Container</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Tainan<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Container</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Container 組件的子組件的樣式都將使用 Container 組件中設置的樣式進行呈現。 這樣做可以讓你擁有一個可以控制樣式的地方。 如果你以後想要更改樣式，則只需調整一個組件。</p>
<h5 id="Public-組件"><a href="#Public-組件" class="headerlink" title="Public 組件"></a>Public 組件</h5><p>這個組件僅簡單的呈現路由名稱到 UI 介面，無論用戶是否登錄均可訪問。在此組件中，將使用 Container 組件添加一些 padding 和 margin 樣式。</p>
<figure class="highlight jsx"><figcaption><span>src/Public.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Container <span class="keyword">from</span> <span class="string">'./Container'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Public = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Container&gt;</span><br><span class="line">    &lt;h1&gt;Public route&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Container&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Public</span><br></pre></td></tr></table></figure>

<h5 id="Nav-組件"><a href="#Nav-組件" class="headerlink" title="Nav 組件"></a>Nav 組件</h5><p>Nav(導航)組件將利用 Ant Design 程式庫和 React Router。 Ant Design 將提供 Menu 和 Icon 組件，以使菜單看起來更加美觀；而 React Router 將提供 Link 組件，以便我們可以鏈接和導航至應用程序的不同部分。</p>
<p>你還會注意到，有一個 current 的屬性傳遞到組件中，該屬性代表當前路由的名稱。 對於此應用程序，該值將為 home、profile、或 protected。 current 的值用於 Menu 組件的 selectedKeys 陣列中，以在導航欄中突顯當前的路由。<br>這個 current 值將在 Router 組件中計算，並作為屬性傳遞給這個 Nav 組件：</p>
<figure class="highlight jsx"><figcaption><span>src/Nav.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Menu &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  HomeOutlined, ProfileOutlined, FileProtectOutlined</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'@ant-design/icons'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Nav = <span class="function">(<span class="params">&#123; current = <span class="string">'home'</span> &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Menu selectedKeys=&#123;[current]&#125; mode=<span class="string">"horizontal"</span>&gt;</span><br><span class="line">      &lt;Menu.Item key=<span class="string">"home"</span>&gt;</span><br><span class="line">        &lt;Link to=&#123;<span class="string">'/'</span>&#125;&gt;</span><br><span class="line">          &lt;HomeOutlined /&gt;Home</span><br><span class="line">        &lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Menu.Item&gt;</span><br><span class="line">      &lt;Menu.Item key=<span class="string">"profile"</span>&gt;</span><br><span class="line">        &lt;Link to=&#123;<span class="string">'/profile'</span>&#125;&gt;</span><br><span class="line">          &lt;ProfileOutlined /&gt;Profile</span><br><span class="line">        &lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Menu.Item&gt;</span><br><span class="line">      &lt;Menu.Item key=<span class="string">"protected"</span>&gt;</span><br><span class="line">        &lt;Link to=&#123;<span class="string">'/protected'</span>&#125;&gt;</span><br><span class="line">          &lt;FileProtectOutlined /&gt;Protected</span><br><span class="line">        &lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Menu.Item&gt;</span><br><span class="line">    &lt;<span class="regexp">/Menu&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Nav;</span><br></pre></td></tr></table></figure>

<h5 id="Protected-組件"><a href="#Protected-組件" class="headerlink" title="Protected 組件"></a>Protected 組件</h5><p>Protected 組件將是受保護或專用的路由。 如果嘗試訪問此路由的用戶已登錄，則他們將能夠查看此路由。 如果未登錄，則將其重導向到 profile 頁面進行註冊或登錄。</p>
<p>在此組件中，將使用 React 的 useEffect 掛鉤和 AWS amplify 的 Auth 類：</p>
<ul>
<li><p>useEffect<br>這是一個 React hook，允許你在函式組件中執行有副作用(side effects)的運算。 該掛鉤接受一個函式，該函式在首次渲染時或(可選擇性的)在其每次渲染時都會被調用。 透過傳入一個空陣列作為第二個參數，則表示只會在組件初次載入時只觸發一次函式。</p>
</li>
<li><p>Auth<br>AWS Amplify class 處理用戶身份管理。 你可以使用此類完成註冊用戶、登錄、到重新設置密碼的所有操作。 在此組件中，我們將調用 Auth.currentAuthenticatedUser 方法，該方法將檢查用戶當前是否已登錄，如果是，則返回有關已登錄用戶的數據。</p>
</li>
</ul>
<figure class="highlight jsx"><figcaption><span>src/Protected.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Auth &#125; <span class="keyword">from</span> <span class="string">'aws-amplify'</span></span><br><span class="line"><span class="keyword">import</span> Container <span class="keyword">from</span> <span class="string">'./Container'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Protected = <span class="function">(<span class="params">&#123; history &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    Auth.currentAuthenticatedUser()</span><br><span class="line">      .catch(<span class="function"><span class="params">()</span> =&gt;</span> history.push(<span class="string">'/profile'</span>))</span><br><span class="line">  &#125;, [])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Container&gt;</span><br><span class="line">      &lt;h1&gt;Protected route&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Container&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Protected</span><br></pre></td></tr></table></figure>

<p>呈現組件後，我們透過在 useEffect 掛鉤中調用 Auth.currentAuthenticatedUser 來檢查用戶是否登錄到應用程序。 如果此 API 調用失敗，則意味著該用戶尚未登錄，我們需要將其重定向。 我們透過調用 history.push(‘/profile’) 重新定向。</p>
<p>在這個元件中我們使用 useEffect 掛鉤以保護需要身份驗證的路由。我們可以創建一個自定義的 protectedRoute 掛鉤用在需要保護的路由上，這樣，可以消除需要在各個組件上重複身份驗證的任何代碼。</p>
<p>在 src 目錄中，創建一個名為 protectedRoute.js 的新文件，並添加以下代碼：</p>
<figure class="highlight jsx"><figcaption><span>src/protectedRoute.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Auth &#125; <span class="keyword">from</span> <span class="string">'aws-amplify'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> protectedRoute = <span class="function">(<span class="params">Comp, route = <span class="string">'/profile'</span></span>) =&gt;</span> <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">checkAuthState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> Auth.currentAuthenticatedUser()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      props.history.push(route)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    checkAuthState()</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Comp</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> protectedRoute</span><br></pre></td></tr></table></figure>

<p>我們可以使用這個自定義的 protectedRoute 掛鉤來保護任何需要保護的組件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> protectedRoute(App)</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> protectedRoute(App, <span class="string">'/about-us'</span>)</span><br></pre></td></tr></table></figure>

<p>現在，我們可以重構我們的應用程序，更新 Protected 組件以使用此新的 protectedRoute 掛鉤：</p>
<figure class="highlight jsx"><figcaption><span>src/Protected.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Container <span class="keyword">from</span> <span class="string">'./Container'</span></span><br><span class="line"><span class="keyword">import</span> protectedRoute <span class="keyword">from</span> <span class="string">'./protectedRoute'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Protected = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Container&gt;</span><br><span class="line">      &lt;h1&gt;Protected route&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Container&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> protectedRoute(Protected)</span><br></pre></td></tr></table></figure>

<h5 id="Router-組件"><a href="#Router-組件" class="headerlink" title="Router 組件"></a>Router 組件</h5><p>Router 組件將定義我們在應用程序中可用的組件和路由。</p>
<p>這個組件將用基於 window.location.href 屬性來設置當前(current)路由名稱，該名稱將用於 Nav 組件，以突顯當前的路由。</p>
<p>這裡還將使用 React Router 的組件 HashRouter、Switch 、和 Route：</p>
<ul>
<li>HashRouter<br>這是使用 URL 的 hash 部分(即 window.location.hash)，使你的 UI 與 URL 保持同步的路由器。</li>
<li>Switch<br>Switch 呈現與位置匹配的第一個子路由。 這與僅使用路由器的預設功能不同，Switch 可以設定渲染多個與位置匹配的路由。</li>
<li>Route<br>這個組件使你可以基於 path 參數定義要渲染的組件：</li>
</ul>
<figure class="highlight jsx"><figcaption><span>src/Router.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter, Switch, Route &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Nav <span class="keyword">from</span> <span class="string">'./Nav'</span></span><br><span class="line"><span class="keyword">import</span> Public <span class="keyword">from</span> <span class="string">'./Public'</span></span><br><span class="line"><span class="keyword">import</span> Profile <span class="keyword">from</span> <span class="string">'./Profile'</span></span><br><span class="line"><span class="keyword">import</span> Protected <span class="keyword">from</span> <span class="string">'./Protected'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Router = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [current, setCurrent] = useState(<span class="string">'home'</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setRoute()</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'hashchange'</span>, setRoute)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">window</span>.removeEventListener(<span class="string">'hashchange'</span>, setRoute)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setRoute</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> location = <span class="built_in">window</span>.location.href.split(<span class="string">'/'</span>)</span><br><span class="line">    <span class="keyword">const</span> pathname = location[location.length - <span class="number">1</span>]</span><br><span class="line">    setCurrent(pathname ? pathname : <span class="string">'home'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;HashRouter&gt;</span><br><span class="line">      &lt;Nav current=&#123;current&#125; /&gt;</span><br><span class="line">      &lt;Switch&gt;</span><br><span class="line">        &lt;Route exact path=<span class="string">"/"</span> component=&#123;Public&#125; /&gt;</span><br><span class="line">        &lt;Route exact path=<span class="string">"/protected"</span> component=&#123;Protected&#125; /&gt;</span><br><span class="line">        &lt;Route exact path=<span class="string">"/profile"</span> component=&#123;Profile&#125; /&gt;</span><br><span class="line">        &lt;Route component=&#123;Public&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>HashRouter&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Router</span><br></pre></td></tr></table></figure>

<p>在此組件的 useEffect 掛鉤內，我們透過調用 setRoute 來設置路由名稱。 我們還設置了一個事件偵聽器，以在路由更改時調用 setRoute，以反映當前的路由。</p>
<h5 id="Profile-組件"><a href="#Profile-組件" class="headerlink" title="Profile 組件"></a>Profile 組件</h5><p>我們要完成應用程序的最後一個組件是 Profile 組件。 這個組件將執行以下操作：</p>
<ul>
<li>如果用戶未登錄，則呈現身份驗證表單</li>
<li>提供登出按鈕</li>
<li>將用戶的個人資料信息呈現到 UI</li>
</ul>
<p>這裡將使用 withAuthenticator 的高階組件(higher-order component HOC)包裝 Profile 組件來呈現身份驗證流程。如果用戶未登錄，這將顯示註冊/登錄表單，如果用戶已登錄，則將顯示帶有用戶個人資料詳細信息的 UI。</p>
<p>我們使用 AmplifySignOut UI 組件來讓用戶登出。該組件將登出用戶，然後重新呈現 UI 以顯示身份驗證表單。</p>
<p>要顯示用戶個人資料數據，我們使用 Auth.currentAuthenticatedUser 方法。 如果用戶已登錄，則此方法將返回用戶配置文件數據以及有關的信息。</p>
<figure class="highlight jsx"><figcaption><span>src/Profile.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Auth &#125; <span class="keyword">from</span> <span class="string">'aws-amplify'</span></span><br><span class="line"><span class="keyword">import</span> &#123; withAuthenticator, AmplifySignOut &#125; <span class="keyword">from</span> <span class="string">'@aws-amplify/ui-react'</span></span><br><span class="line"><span class="keyword">import</span> Container <span class="keyword">from</span> <span class="string">'./Container'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Profile = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = useState(&#123;&#125;)</span><br><span class="line">  </span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    checkUser()</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">checkUser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> Auth.currentUserPoolUser()</span><br><span class="line">      <span class="keyword">const</span> userInfo = &#123; <span class="attr">username</span>: data.username, ...data.attributes &#125;</span><br><span class="line">      setUser(userInfo)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123; <span class="built_in">console</span>.log(<span class="string">'error: '</span>, err) &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Container&gt;</span><br><span class="line">      &lt;h1&gt;Profile&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;h2&gt;Username: &#123;user.username&#125;&lt;/</span>h2&gt;</span><br><span class="line">      &lt;h3&gt;Email: &#123;user.email&#125;&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">      &lt;h4&gt;Phone: &#123;user.phone_number&#125;&lt;/</span>h4&gt;</span><br><span class="line">      &lt;AmplifySignOut /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Container&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withAuthenticator(Profile)</span></span><br></pre></td></tr></table></figure>

<h5 id="樣式化-UI-組件"><a href="#樣式化-UI-組件" class="headerlink" title="樣式化 UI 組件"></a>樣式化 UI 組件</h5><p>在背後，Amplify 使用 Web 組件實現它的 UI 組件，這意味著我們可以將它們當成 HTML 元素的第一等類別來使用 CSS 樣式。 我們希望我們的 UI 組件與應用程序其他部分中的顏色匹配，我們可以在 index.css 的底部添加以下 CSS 屬性，以定義我們要使用的顏色：</p>
<figure class="highlight css"><figcaption><span>src/index.css</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attribute">--amplify-primary-color</span>: <span class="number">#1890ff</span>;</span><br><span class="line">  <span class="attribute">--amplify-primary-tint</span>: <span class="number">#1890ff</span>;</span><br><span class="line">  <span class="attribute">--amplify-primary-shade</span>: <span class="number">#1890ff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="配置應用程序"><a href="#配置應用程序" class="headerlink" title="配置應用程序"></a>配置應用程序</h5><p>現在，應用程序組件已構建。 我們需要做的最後一件事是更新 index.js 以導入 Router 路由器並添加 Amplify 配置。以及為 Ant Design 程式庫導入必要的 CSS 樣式。</p>
<figure class="highlight js"><figcaption><span>src/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.css'</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'./Router'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'antd/dist/antd.css'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Amplify <span class="keyword">from</span> <span class="string">'aws-amplify'</span></span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'./aws-exports'</span></span><br><span class="line">Amplify.configure(config)</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Router /&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>現在啟動應用程序:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn start</span><br></pre></td></tr></table></figure>

<p>現在測試一下你的應用程序，註冊一個用戶、確認 MFA 代碼 (驗證碼會透過 email 傳送)、登入、登出以及受保護的路由。</p>
<p>在此示例中，我們學到了幾點:</p>
<ul>
<li><p>使用 withAuthenticator HOC 可以快速啟動並運行預配置的身份驗證流程。</p>
</li>
<li><p>使用 Auth 類可對身份驗證進行更細粒度的控制，並獲取有關當前登錄用戶的數據。</p>
</li>
<li><p>Ant Design 可幫助你進行預配置設計，而無需編寫任何特定於樣式的代碼。</p>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/03/AWS-Serverless-GraphQL-API/" rel="prev" title="AWS Serverless GraphQL API">
      <i class="fa fa-chevron-left"></i> AWS Serverless GraphQL API
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/11/11/AWS-Offline-Apps-with-Amplify-DataStore/" rel="next" title="AWS Offline Apps with Amplify DataStore">
      AWS Offline Apps with Amplify DataStore <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Amazon-Cognito"><span class="nav-number">1.</span> <span class="nav-text">Amazon Cognito</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Amazon-Cognito-的運作方式"><span class="nav-number">1.1.</span> <span class="nav-text">Amazon Cognito 的運作方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Amazon-Cognito-與-AWS-Amplify"><span class="nav-number">1.2.</span> <span class="nav-text">Amazon Cognito 與 AWS Amplify</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#創建-React-應用程序與-Amplify-專案"><span class="nav-number">2.</span> <span class="nav-text">創建 React 應用程序與 Amplify 專案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#客戶端身份驗證概述"><span class="nav-number">2.1.</span> <span class="nav-text">客戶端身份驗證概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#構建前端應用程序"><span class="nav-number">2.2.</span> <span class="nav-text">構建前端應用程序</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Container-組件"><span class="nav-number">2.2.1.</span> <span class="nav-text">Container 組件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Public-組件"><span class="nav-number">2.2.2.</span> <span class="nav-text">Public 組件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Nav-組件"><span class="nav-number">2.2.3.</span> <span class="nav-text">Nav 組件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Protected-組件"><span class="nav-number">2.2.4.</span> <span class="nav-text">Protected 組件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Router-組件"><span class="nav-number">2.2.5.</span> <span class="nav-text">Router 組件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Profile-組件"><span class="nav-number">2.2.6.</span> <span class="nav-text">Profile 組件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#樣式化-UI-組件"><span class="nav-number">2.2.7.</span> <span class="nav-text">樣式化 UI 組件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置應用程序"><span class="nav-number">2.2.8.</span> <span class="nav-text">配置應用程序</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="J.Y. Yang"
      src="/images/1184yang.jpg">
  <p class="site-author-name" itemprop="name">J.Y. Yang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/1184yang" title="GitHub → https://github.com/1184yang" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1184yang@gmail.com" title="E-Mail → mailto:1184yang@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/1184yang" title="Twitter → https://twitter.com/1184yang" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">J.Y. Yang</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
